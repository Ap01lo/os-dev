## 第二章 计算机结构以及引导程序

### 2.1 启动过程

现在，我们要开始我们的旅程了：

当我们重启电脑时，机器必须完完全全重新启动，开始时没有任何操作系统的概念在其中。然后，机器需要从一个稳定长久的存储设备中继续加载操作系统，当然也可能是别的什么东西，这些存储设备需要连接到计算机（比如软盘，硬盘，USB盘等等）。

我们很快就会发现，我们所用的电脑为我们的操作系统所提供的预加载环境提供了很少的服务：在这个阶段，我们想要一个基本的文件系统甚至都是奢侈的，我们根本无法使用他们。但是所幸，我们有BIOS(Basic input output system)，这是一个软件的例行程序的集合，这些例行程序在计算机开机加电的时候被从内存中加载到硬盘，并且初始化。BIOS系统提供了自检测服务和计算机重要设备的及嫩管理程序，比如屏幕，键盘，硬盘等等。

在BIOS完成一些基本的硬件检测之后（特别是装载的内存区域工作是否正常），他就要引导存放在某个设备上的操作系统了。在这里我们需要记住，虽然但是，BIOS不能只简单的加载一个代表操作系统的文件然后拿来启动，因为BIOS还没有文件系统的概念。BIOS必须要读取磁盘上的某个特定扇区的数据（通常为512byte大小），比如第3个柱面，第2个磁道，第5个扇区。

因此，对于BIOS来说，找到OS存放位置的最简单的地方就是一个磁盘的第一个扇区（第0柱面，第0磁道，第0扇区），也就是我们所熟知的引导扇区。因为不是所有的磁盘上都有操作系统，所以BIOS必须搞清楚哪些磁盘的引导扇区是可执行的引导程序，哪些磁盘的引导扇区里只是简单的数据。需要注意的是，cpu在执行指令的时候，不能区分什么是可执行程序，什么是数据，一切二进制数据都可以被翻译为指令。

在这里，一个看起来没什么道理的方式被BIOS采纳了，一个将要被执行的引导扇区的最后两个字节的内容必须是魔法数字 `0xaa55`。由此，BIOS系统就可以在每个存储里循环检索，将可用的引导扇区的内容加载到内存中，然后指示cpu开始执行它所找到的以那个魔法数字结尾的第一个引导扇区。




